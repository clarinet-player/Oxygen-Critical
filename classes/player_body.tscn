[gd_scene load_steps=3 format=3 uid="uid://bve504yaouv3p"]

[sub_resource type="GDScript" id="GDScript_n1bfo"]
script/source = "class_name PlayerBody
extends RigidBody3D


var anchored_body : RigidBody3D

var _jump_request_time : int
var _jump_vector : Vector3


func _integrate_forces(state):
	
	#movement
	
	#jumping
	if anchored_body and Time.get_ticks_msec() - _jump_request_time < 100:
		_jump_request_time = 0
		jump()


func try_jump(direction : Vector3):
	_jump_request_time = Time.get_ticks_msec()
	_jump_vector = direction


func jump():
	detach()
	apply_central_impulse(_jump_vector)


func attach(body):
	reparent(body)
	anchored_body = body


func detach():
	var offset : Vector3 = position
	
	reparent(anchored_body.get_parent())
	
	apply_central_impulse( anchored_body.linear_velocity )
	apply_central_impulse( position.cross( anchored_body.angular_velocity ) )
	
	anchored_body = null
"

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_be7sq"]

[node name="player_body" type="RigidBody3D"]
custom_integrator = true
script = SubResource("GDScript_n1bfo")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_be7sq")
